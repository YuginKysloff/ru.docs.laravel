# Настройка

- [Введение](#introduction)
- [Настройка окружения](#environment-configuration)
    - [Определение текущего окружения](#determining-the-current-environment)
- [Доступ к настройкам конфигурации](#accessing-configuration-values)
- [Кэширование настроек](#configuration-caching)
- [Режим обслуживания](#maintenance-mode)

<a name="introduction"></a>
## Введение

Все конфигурационные файлы фреймворка Laravel расположены в директории `config`. Параметры в каждом из них снабжены комментариями, поэтому не стесняйтесь пройтись по этим файлам и познакомиться с доступными параметрами настройки.

<a name="environment-configuration"></a>
## Настройка окружения

Часто полезно иметь разные параметры настройки в зависимости от окружения, в котором работает приложение. Например, на рабочем сервере вы можете использовать одну систему кэширования, а на локальном - другую.

Для предоставления такой возможности, Laravel использует PHP-библиотеку [DotEnv](https://github.com/vlucas/phpdotenv) от Вэнса Лукаса. В свежей установке Laravel, в корневой директории вашего приложения находится файл `.env.example`. Если вы установили Laravel через Composer, то этот файл автоматически переименовался в `.env`. В противном случае, вам необходимо переименовать его самостоятельно.

> {tip} Вы также можете создать файл `.env.testing`. Он переопределит значения из файла `.env` при запуске PHPUnit-тестов или выполнении команд Artisan с параметром `--env=testing`.

#### Получение настроек окружения

Все переменные, описанные в этом файле, загружаются в суперглобальную переменную `$_ENV` при получении приложением какого-либо запроса. Однако, вы можете использовать хелпер `env` для получения значений этих переменных из ваших конфигурационных файлов. На самом деле, если вы ознакомитесь с конфигурационными файлами Laravel, то увидите несколько параметров, которые уже используют этот хелпер:

    'debug' => env('APP_DEBUG', false),

Второй принимаемый параметр функции `env` является "значением по умолчанию". Оно будет использоваться в тех случаях, когда переменной окружения для заданного ключа не существует.

Файл `.env` не должен коммититься в вашу систему контроля версий, так как каждый из разработчиков и серверов, использующих ваше приложение, может иметь свои собственные настройки окружения.

Если вы занимаетесь разработкой в команде, то вы можете включить файл `.env.example` в ваше приложение. Оставив плейсхолдеры для значений в примере конфигурационного файла, другие разработчики в вашей команде смогут увидеть переменные окружения, необходимые для запуска вашего приложения.

<a name="determining-the-current-environment"></a>
### Определение текущего окружения

Текущее окружение приложения определяется переменной `APP_ENV` в вашем файле `.env`. Вы можете получить доступ к её значению с помощью метода `environment` [фасада](/docs/{{version}}/facades) `App`:

    $environment = App::environment();

Вы также можете передать аргументы в метод `environment` для проверки совпадения окружения с каким-либо значением. Метод возвращает `true` в случае совпадения с любым из предоставленных значений:

    if (App::environment('local')) {
        // Окружение local
    }

    if (App::environment('local', 'staging')) {
        // Окружение local ИЛИ staging
    }

<a name="accessing-configuration-values"></a>
## Доступ к настройкам конфигурации

Вы можете легко получить доступ к значениям ваших параметров конфигурации из любой части вашего приложения с помощью глобальной хелпер-функции `config`. Значения параметров конфигурации могут быть получены с использованием синтаксиса "точка", который включает в себя название файла и параметра, который вы хотите получить. Также вы можете указать стандартное значение, которое будет возвращено в том случае, если искомый параметр конфигурации не существует:

    $value = config('app.timezone');

Для установки параметров конфигурации в процессе работы приложения, передайте массив в хелпер-функцию `config`:

    config(['app.timezone' => 'America/Chicago']);

<a name="configuration-caching"></a>
## Кэширование настроек

Для ускорения работы вашего приложения, вам следует кэшировать все ваши конфигурационные файлы в один файл с использование команды Artisan `config:cache`. Она объединит все конфигурационные параметры вашего приложения в единый файл, который быстрее загружается фреймворком.

Обычно, вам следует запускать команду `php artisan config:cache` в процессе деплоймента приложения на ваш рабочий сервер. Команда не должна запускаться при разработке приложения, так как в процессе этого параметры конфигурации довольно часто необходимо изменять.

> {note} Если вы выполняете команду `config:cache` в процессе деплоймента, то вы должны убедиться в том, что в конфигурационных файлах вы вызываете исключительно функцию `env`.

<a name="maintenance-mode"></a>
## Режим обслуживания

Когда ваше приложение находится в режиме обслуживания, то на все поступающие в приложение запросы будет отображено специальное представление. Это позволяет легко "отключить" ваше приложение в процессе обновления или при выполнении технического обслуживания. Проверка на режим облуживания включена в стандартный стек последников (middlewares) вашего приложения. Если приложение находится в режиме обслуживания, то будет вызываться исключение `MaintenanceModeException` с кодом статуса 503.

Для включения режима обслуживания, просто выполните команду Artisan `down`:

    php artisan down

В качестве параметров команды `down` вы можете указать `message` и `retry`. Значение `message` может быть использовано для отображения любого информационного текста, а значение `retry` будет установлено в качестве значения HTTP-заголовка `Retry-After`:

    php artisan down --message="Upgrading Database" --retry=60

Для отключения режима обслуживания, выполните команду Artisan `up`:

    php artisan up

#### Шаблон ответа режима обслуживания

Стандартный шаблон, отображающийся при включенном режиме обслуживания, находится в `resources/views/errors/503.blade.php`. При необходимости, вы можете изменить его.

#### Режим обслуживания и запросы

При включенном режиме обслуживание, обработка [очередей](/docs/{{version}}/queues) приостанавливается. Они продолжат обрабатываться при выходе приложения из режима обслуживания.

#### Альтернативы режиму обслуживания

Так как режим обслуживания приводит к недоступности приложения в течение нескольких секунд, рассмотрите [Envoyer](https://envoyer.io) в качестве альтернативы для деплоймента вашего приложения с нулевым временем простоя.
